
<!DOCTYPE html>
<html>

<head>
  <title>WebAudio Csound</title>
 
  <script type="text/javascript" src="js/csound.js"></script>
    <script type="text/javascript" src="js/CsoundObj.js"></script>
   <script type="text/javascript">
    // called by csound.js
    function moduleDidLoad() {
      csound.Play();
      csound.CompileOrc(
        `massign 1,1
        instr 1
  icps = cpsmidi()
  chnset icps, \"freq\"
  k1 linenr 0.9,0.03,0.3, 0.09
  a1 oscili k1, icps
  outs a1,a1
  endin`);

    }

    function attachListeners() {
      var notes = ['c', 'd', 'e', 'g', 'a'];
      for (i = 0; i < notes.length; i++) {
        document.getElementById(notes[i]).
        addEventListener("mousedown", Play);
        document.getElementById(notes[i]).
        addEventListener("mouseup", Stop);
        document.getElementById(notes[i]).
        addEventListener("mouseleave", Stop);
        document.getElementById(notes[i]).
        addEventListener("touchstart", Play);
        document.getElementById(notes[i]).
        addEventListener("touchend", Stop);
        document.getElementById(notes[i]).
        addEventListener("touchmove", Stop);
      }
    }
    var count = 0;

    function handleMessage(message) {
      var element = document.getElementById('console');
      element.value += message;
      element.scrollTop = 99999; // focus on bottom
      count += 1;
      if (count == 1000) {
        element.value = ' ';
        count = 0;
      }
    }
    var started = false;
    var playing = false;
    // click handler
    function Play(event) {
      event.preventDefault();
      if (started == false) {
        CSOUND_AUDIO_CONTEXT.resume();
        started = true;
      }
      let note = event.target.value;
      csound.NoteOn(1, note, 60);
      playing = true;
    }

    function Stop(event) {
      event.preventDefault();
      if (playing) {
        let note = event.target.value;
        csound.NoteOff(1, note, 60);
        playing = false;
      }
    }
  </script>
</head>

<body>
  <H1> Virtual MIDI Keys </H1>
  <p>
    <button id="c" value=60>C</button>
    <button id="d" value=62>D</button>
    <button id="e" value=64>E</button>
    <button id="g" value=67>G</button>
    <button id="a" value=69>A</button>
  </p>
  <textarea class="console" rows="20" id="console">Csound: not loaded</textarea>
</body>

</html>
